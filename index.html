<!DOCTYPE html>
<html>
<head>
    <title>Jiji ya Chogoria - Login/Signup</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7"></script>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>Jiji ya Chogoria</h1>
        </div>
    </header>
    
    <main class="container">
        <div id="auth-container" class="form-container">
            <div id="login-section">
                <h2>Login</h2>
                <form id="login-form">
                    <input type="email" id="login-email" placeholder="Email" required>
                    <input type="password" id="login-password" placeholder="Password" required>
                    <button type="submit">Login</button>
                </form>
                <div class="form-toggle">
                    <p>Don't have an account? <a id="show-signup">Sign Up</a></p>
                </div>
            </div>
            
            <div id="signup-section" class="hidden">
                <h2>Signup</h2>
                <form id="signup-form">
                    <input type="text" id="signup-name" placeholder="Full Name" required>
                    <input type="email" id="signup-email" placeholder="Email" required>
                    <input type="password" id="signup-password" placeholder="Password" required>
                    <button type="submit">Signup</button>
                </form>
                <div class="form-toggle">
                    <p>Already have an account? <a id="show-login">Log In</a></p>
                </div>
            </div>
            <div id="auth-message"></div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Jiji ya Chogoria by mannuh. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://lrezerxsbuekkhmpverr.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxyZXplcnhzYnVla2tobXB2ZXJyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzNTI3MjMsImV4cCI6MjA3MzkyODcyM30.96senppPRMHveFi2ouDPDqhh17XIwxsLvA4U0rvjU9g';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Toast notification function
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Check if user is already logged in
        async function checkSession() {
            const { data: { user } } = await supabase.auth.getUser();
            if (user) {
                window.location.href = 'dashboard.html';
            }
        }

        // Show message
        function showMessage(message, isError = false) {
            const messageDiv = document.getElementById('auth-message');
            messageDiv.textContent = message;
            messageDiv.style.color = isError ? 'var(--error)' : 'var(--success)';
            messageDiv.style.marginTop = '10px';
        }

        // Toggle between login and signup forms
        const loginSection = document.getElementById('login-section');
        const signupSection = document.getElementById('signup-section');
        const showSignupLink = document.getElementById('show-signup');
        const showLoginLink = document.getElementById('show-login');

        showSignupLink.addEventListener('click', () => {
            loginSection.classList.add('hidden');
            signupSection.classList.remove('hidden');
            document.getElementById('auth-message').textContent = '';
        });

        showLoginLink.addEventListener('click', () => {
            signupSection.classList.add('hidden');
            loginSection.classList.remove('hidden');
            document.getElementById('auth-message').textContent = '';
        });

        // Login form handler
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({ email, password });
                
                if (error) {
                    showToast(error.message, 'error');
                } else {
                    showToast('Login successful!');
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 1000);
                }
            } catch (error) {
                showToast('Login failed: ' + error.message, 'error');
            }
        });

        // Signup form handler
        document.getElementById('signup-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            
            try {
                const { data, error } = await supabase.auth.signUp({ 
                    email, 
                    password,
                    options: { 
                        data: { full_name: name },
                        emailRedirectTo: window.location.origin
                    }
                });
                
                if (error) {
                    showToast(error.message, 'error');
                } else {
                    showToast('Account created! Please check your email to confirm your account.');
                    document.getElementById('signup-form').reset();
                    signupSection.classList.add('hidden');
                    loginSection.classList.remove('hidden');
                }
            } catch (error) {
                showToast('Signup failed: ' + error.message, 'error');
            }
        });

        // Check session on page load
        checkSession();
    </script>
</body>
</html>